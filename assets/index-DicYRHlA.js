(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))s(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const i of n.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function r(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(e){if(e.ep)return;e.ep=!0;const n=r(e);fetch(e.href,n)}})();function P(o,t,r){const s=document.getElementById("fileInput"),e=document.getElementById("uploadArea");document.getElementById("uploadContainer"),s.addEventListener("change",n=>{f(n.target.files,o,t,r)}),e.addEventListener("dragover",n=>{n.preventDefault(),e.classList.add("drag-over")}),e.addEventListener("dragleave",()=>{e.classList.remove("drag-over")}),e.addEventListener("drop",n=>{n.preventDefault(),e.classList.remove("drag-over"),n.dataTransfer.files.length>0&&f(n.dataTransfer.files,o,t,r)}),e.addEventListener("click",n=>{n.target.classList.contains("upload-button")||s.click()})}function f(o,t,r,s){if(o.length===0)return;const e=o[0];if(!B(e)){t.showError("Invalid File Type","Please select a PNG image file.");return}if(e.size>10*1024*1024){t.showError("File Too Large","Please select an image under 10MB.");return}C(e,t,r,s)}function B(o){return o.type==="image/png"}function C(o,t,r,s){t.showProcessing(),w(o).then(e=>{t.updateOriginalPreview(e,o.name,o.size),r.processImage(o).then(n=>{w(n).then(i=>{t.updateReducedPreview(i,n.name,n.size);const d=b(o.size,n.size);t.updateReductionInfo(d),s.setDownloadFile(n),t.showResult()})}).catch(n=>{console.error("Error processing image:",n),t.showError("Processing Failed","There was an error processing your image. Please try again.")})}).catch(e=>{console.error("Error creating preview:",e),t.showError("Preview Failed","There was an error creating a preview of your image. Please try again.")})}function w(o){return new Promise((t,r)=>{const s=new FileReader;s.onload=e=>{t(e.target.result)},s.onerror=e=>{r(e)},s.readAsDataURL(o)})}function b(o,t){if(o===0)return 0;const s=(o-t)/o*100;return Math.round(s)}function R(o){const t="http://103.146.23.106:8080";return{processImage:async s=>{try{const e=new FormData;e.append("file",s);const n=await fetch(`${t}/compress`,{method:"POST",body:e});if(!n.ok)throw new Error("Failed to process image");const i=await n.json();if(!i.download_url)throw new Error("Invalid response from server");const d=await fetch(`${t}${i.download_url}`);if(!d.ok)throw new Error("Failed to download processed image");const a=await d.blob();return new File([a],s.name.replace(".png","_reduced.png"),{type:"image/png"})}catch(e){throw console.error("Error processing image:",e),e}}}}function T(o){let t=null;const r=document.getElementById("downloadButton");r.addEventListener("click",()=>{t?e():o.showError("Download Error","No reduced image available for download.")});const s=d=>{t=d,r.removeAttribute("disabled"),r.classList.remove("disabled")},e=()=>{const d=URL.createObjectURL(t),a=document.createElement("a");a.href=d,a.download=t.name,document.body.appendChild(a),a.click(),document.body.removeChild(a),setTimeout(()=>{URL.revokeObjectURL(d)},100),n()},n=()=>{const d=r.textContent;r.textContent="Downloading...",r.classList.add("downloading"),setTimeout(()=>{r.textContent=d,r.classList.remove("downloading")},1500)};return{setDownloadFile:s,reset:()=>{t=null,r.setAttribute("disabled","disabled"),r.classList.add("disabled")}}}function F(){const o=document.getElementById("uploadContainer"),t=document.getElementById("processingContainer"),r=document.getElementById("resultContainer"),s=document.getElementById("errorContainer"),e=document.getElementById("progressBar"),n=document.getElementById("originalPreview"),i=document.getElementById("reducedPreview"),d=document.getElementById("originalSize"),a=document.getElementById("reducedSize"),m=document.getElementById("reductionPercentage"),h=document.getElementById("errorTitle"),L=document.getElementById("errorMessage"),v=()=>{o.classList.add("hidden"),t.classList.remove("hidden"),r.classList.add("hidden"),s.classList.add("hidden"),g(0)},E=()=>{o.classList.add("hidden"),t.classList.add("hidden"),r.classList.remove("hidden"),s.classList.add("hidden"),r.classList.add("fade-in"),setTimeout(()=>{r.classList.remove("fade-in")},500)},y=(c,u)=>{o.classList.add("hidden"),t.classList.add("hidden"),r.classList.add("hidden"),s.classList.remove("hidden"),h.textContent=c,L.textContent=u,s.classList.add("fade-in"),setTimeout(()=>{s.classList.remove("fade-in")},500)},I=()=>{o.classList.remove("hidden"),t.classList.add("hidden"),r.classList.add("hidden"),s.classList.add("hidden"),n.innerHTML="",i.innerHTML="",d.textContent="0",a.textContent="0",m.textContent="0",g(0),document.getElementById("fileInput").value=""},g=c=>{e.style.width=`${c}%`};return{showProcessing:v,showResult:E,showError:y,resetUI:I,updateProgress:g,updateOriginalPreview:(c,u,p)=>{const l=document.createElement("img");l.src=c,l.alt=u,l.classList.add("preview-image"),n.innerHTML="",n.appendChild(l),d.textContent=(p/1024).toFixed(2)},updateReducedPreview:(c,u,p)=>{const l=document.createElement("img");l.src=c,l.alt=u,l.classList.add("preview-image"),i.innerHTML="",i.appendChild(l),a.textContent=(p/1024).toFixed(2)},updateReductionInfo:c=>{m.textContent=c}}}document.addEventListener("DOMContentLoaded",()=>{const o=F(),t=R(),r=T(o);P(o,t,r),document.getElementById("resetButton").addEventListener("click",()=>{o.resetUI()}),document.getElementById("errorResetButton").addEventListener("click",()=>{o.resetUI()})});
